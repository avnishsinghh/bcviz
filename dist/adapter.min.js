/*! bcviz 1.3.3 - 2021/06/21 13:07:24 GMT+0000 | (c)2021 Genome Research Ltd */

define(["jquery","d3"],function(jQuery,d3){"use strict";function format_adapter_chart(data){var k,formattedData=[];for(k in data.start_counts)formattedData.push({xVar:parseInt(k,10),yVar:data.start_counts[k]});return formattedData}function roundToPowerOfTen(aNumb){return Math.pow(10,Math.ceil(Math.log(aNumb)/Math.LN10))}function adapterChart(data,xAxis,yAxis,yMin,yMax,padding_left,svg,nodeWidth){var w=padding_left||500,h=svg||250,padding_top=36,padding_right=25,padding_bottom=25,padding_left=50,svg=document.createElementNS(d3.ns.prefix.svg,"svg"),svg=d3.select(svg).attr("width",w).attr("height",h);nodeWidth&&svg.append("text").attr("transform","translate("+padding_left+", "+padding_top/4+")").style("font-size",padding_top/4).text(nodeWidth);for(var nodeWidth=(w-padding_left-padding_right)/yAxis,xScale=d3.scale.linear().nice().range([padding_left,w-padding_right]).domain([xAxis,yAxis]),yScale=d3.scale.log().clamp(!0).nice().range([h-padding_bottom,padding_top]),xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(10),vArray=[],n=0;n<Math.log(yMax)/Math.LN10;n++)vArray.push(Math.pow(10,n));vArray.push(Math.pow(10,n));yAxis=d3.svg.axis().scale(yScale).orient("left").tickValues(vArray).ticks(5,function(d){if(1<=d)return"10"+"⁰¹²³⁴⁵⁶⁷⁸⁹"[Math.round(Math.log(d)/Math.LN10)]});return svg.append("g").attr("class","axis").attr("transform","translate(0,"+(h-padding_bottom)+")").call(xAxis),svg.append("text").attr("transform","translate("+(padding_left-5)+","+(h-padding_bottom+17)+")").text(data.min_isize),yScale.domain([yMin,yMax]),svg.append("g").attr("class","axis").attr("transform","translate("+padding_left+", 0)").call(yAxis),svg.append("g").attr("class","grid").attr("transform","translate(0,"+(h-padding_bottom)+")").call(d3.svg.axis().scale(xScale).orient("bottom").ticks(10).tickSize(-h+(padding_top+padding_bottom),0,0).tickFormat("")),svg.append("g").attr("class","grid").attr("id","yGrid").attr("transform","translate("+padding_left+",0)").call(d3.svg.axis().scale(yScale).orient("left").ticks(10).tickSize(-w+(padding_left+padding_right),0,0).tickFormat("")),svg.append("g").selectAll("rect").data(data.formattedData).enter().append("rect").attr("x",function(d){return xScale(d.xVar)}).attr("y",function(d){return yScale(d.yVar)}).attr("width",nodeWidth).attr("height",function(d){return h-padding_bottom-yScale(d.yVar)}).attr("fill","blue").attr("opacity",.6).attr("stroke-width","1px").attr("stroke","white"),svg}return{drawChart:function(xMax){var reverseData,xMin,svg_fwd,svg_rev,data=xMax.data,width=xMax.width,height=xMax.height,title=xMax.title||"";return data&&"object"==typeof data&&(svg_rev={},data.forward_fasta_read_count=+data.forward_fasta_read_count,data.reverse_fasta_read_count=+data.reverse_fasta_read_count,svg_fwd=Object.create(svg_rev),reverseData=Object.create(svg_rev),svg_fwd.start_counts=data.forward_start_counts,reverseData.start_counts=data.reverse_start_counts,svg_fwd.formattedData=format_adapter_chart(svg_fwd),reverseData.formattedData=format_adapter_chart(reverseData),svg_fwd.yMax=roundToPowerOfTen(d3.max(svg_fwd.formattedData,function(d){return d.yVar})),isNaN(svg_fwd.yMax)&&(svg_fwd.yMax=0),reverseData.yMax=roundToPowerOfTen(d3.max(reverseData.formattedData,function(d){return d.yVar})),isNaN(reverseData.yMax)&&(reverseData.yMax=0),xMin=d3.min(svg_fwd.formattedData.concat(reverseData.formattedData),function(d){return d.xVar}),xMax=d3.max(svg_fwd.formattedData.concat(reverseData.formattedData),function(d){return d.xVar}),svg_rev=d3.max(svg_fwd.formattedData.concat(reverseData.formattedData),function(d){return d.yVar}),svg_fwd=adapterChart(svg_fwd,xMin,xMax,.1,svg_rev=roundToPowerOfTen(svg_rev),width,height,"Forward "+title),svg_rev=adapterChart(reverseData,xMin,xMax,.1,svg_rev,width,height,"Reverse "+title),data.forward_fasta_read_count||(svg_fwd=null),data.reverse_fasta_read_count||(svg_rev=null)),{svg_fwd:svg_fwd,svg_rev:svg_rev}},_formatChart:format_adapter_chart,_roundToPowerOfTen:roundToPowerOfTen}});