/*! bcviz 1.3.3 - 2021/06/21 13:07:24 GMT+0000 | (c)2021 Genome Research Ltd */

define(["jquery","d3"],function(jQuery,d3){"use strict";var xScale,yScale;return{drawChart:function(title){var data=title.data,width=title.width,height=title.height,title=title.title||"";return data&&"object"==typeof data&&null!=data.bins&&1<data.bins.length?function(data,width,height,nodeWidth){width=width||650;height=height||300;var padding_top=50,padding_right=25,padding_bottom=25,padding_left=50,yAxis=document.createElementNS(d3.ns.prefix.svg,"svg"),svg=d3.select(yAxis).attr("width",width).attr("height",height);svg.append("text").attr("transform","translate("+padding_left+", "+padding_top/4+")").style("font-size",padding_top/4).text(nodeWidth),data.bin_width=+data.bin_width,data.min_isize=+data.min_isize,data.mean=+data.mean,data.std=+data.std,data.paired_reads_direction_in=+data.paired_reads_direction_in,data.num_well_aligned_reads_opp_dir=+data.num_well_aligned_reads_opp_dir,data.num_well_aligned_reads=+data.num_well_aligned_reads,data.bins.forEach(function(v,i,a){a[i]=+v});var xMin=data.min_isize,xAxis=data.bins.length*data.bin_width+data.min_isize,yAxis=d3.max(data.bins),nodeWidth=(width-padding_left-padding_right)/data.bins.length;xScale=d3.scale.linear().nice().range([padding_left,width-padding_right]).domain([xMin,xAxis]),yScale=d3.scale.linear().nice().range([height-padding_bottom,padding_top]).domain([0,yAxis]);xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(10).tickFormat(function(d){return 100==d&&50<xMin?"":d}),yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(10);svg.append("g").attr("class","axis").attr("transform","translate("+padding_left+", 0)").call(yAxis),svg.append("g").attr("class","axis").attr("transform","translate(0,"+(height-padding_bottom)+")").call(xAxis),svg.append("text").attr("transform","translate("+(padding_left-5)+","+(height-padding_bottom+17)+")").text(data.min_isize),svg.append("g").attr("class","grid").attr("id","xGrid").attr("transform","translate(0,"+(height-padding_bottom)+")").call(d3.svg.axis().scale(xScale).orient("bottom").ticks(10).tickSize(-height+(padding_top+padding_bottom),0,0).tickFormat("")),svg.append("g").attr("class","grid").attr("id","yGrid").attr("transform","translate("+padding_left+",0)").call(d3.svg.axis().scale(yScale).orient("left").ticks(10).tickSize(-width+(padding_left+padding_right),0,0).tickFormat("")),svg.append("g").selectAll("rect").data(data.bins).enter().append("rect").attr("x",function(d,i){return xScale(i*data.bin_width+data.min_isize)}).attr("y",function(d){return yScale(d)}).attr("width",nodeWidth).attr("height",function(d){return height-padding_bottom-yScale(d)}).attr("fill",data.paired_reads_direction_in?"blue":"orange").attr("opacity",.6).attr("stroke-width","1px").attr("stroke","white"),data.norm_fit_modes&&function(data,svg){var mean=data.mean,std=data.std;data.norm_fit_modes.forEach(function(d){3==d.length&&(mean=d[1],std=d[2])});var norm=[];data.bins.forEach(function(v,i){var m=std*Math.sqrt(2*Math.PI),e=i*data.bin_width+data.min_isize,e=Math.exp(-(e-mean)*(e-mean)/(2*std*std));norm.push({x:i,y:e/m})});var max_norm=0;norm.forEach(function(v){max_norm<v.y&&(max_norm=v.y)});var scale=Math.max.apply(null,data.bins)/max_norm,lineFunc=d3.svg.line().x(function(d){return xScale(d.x*data.bin_width+data.min_isize)}).y(function(d){return yScale(d.y*scale)}).interpolate("basis");svg.append("svg:path").attr("d",lineFunc(norm)).attr("stroke","black").attr("stroke-width",2).attr("fill","none")}(data,svg);return{svg:svg}}(data,width,height,title):null}}});